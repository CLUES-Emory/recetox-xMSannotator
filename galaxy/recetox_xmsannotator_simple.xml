<tool id="recetox_xmsannotator_simple" name="xmsannotator - simple" version="1.0">
    <macros>
        <import>recetox_xmsannotator_macros.xml</import>
    </macros>

    <requirements>
        <container type="docker">registry.gitlab.ics.muni.cz:443/recetox/mass-spectrometry/xmsannotator:deployment</container>
    </requirements>

    <command detect_errors="aggressive"><![CDATA[
        Rscript -e 'annotation <- xmsannotator::simple_annotation(
                        data = arrow::read_feather("$peak_list"),
                        metabolites = rhdf5::h5read("$metabolites", "metabolites"),
                        mz_tolerance = as.double(mz_tolerance)
                   )'
                -e 'arrow::write_feather(annotation, "$annotation")'
    ]]></command>

    <inputs>
        <param name="peak_list" type="data" format="peak_list.feather" label="Peak intensity table"/>
        <param name="metabolites" type="data" format="metabolites.h5" label="Metabolite database"/>
        <param name="mz_tolerance" type="float" value="10" min="0" label="Mass tolerance [ppm]" help="Mass tolerance in ppm for database matching."/>
        <!-- <expand macro="peak_list"/>
        <expand macro="metabolites"/>
        <expand macro="mz_tolerance"/> -->
    </inputs>

    <outputs>
        <data format="annotated_peak_list.feather" name="annotation"/>
        <!-- <expand macro="annotation_output"/> -->
    </outputs>

    <help><![CDATA[]]></help>

    <citations>
        <citation type="doi">10.1021/acs.analchem.6b01214</citation>
    </citations>
</tool>